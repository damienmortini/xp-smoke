class Signal extends Set{constructor(){super(),this._onceCallbacks=new Set}add(e,{once:t=!1}={}){t&&this._onceCallbacks.add(e),super.add(e)}dispatch(e){for(let t of this)t(e),this._onceCallbacks.has(t)&&(this._onceCallbacks.delete(t),this.delete(t))}}class Ticker extends Signal{constructor(){super(),this._updateBinded=this._update.bind(this),this.time=.001*window.performance.now(),this._previousTime=this.time,this.deltaTime=0,this.timeScale=1,this._update()}_update(){requestAnimationFrame(this._updateBinded),this.time=.001*window.performance.now(),this.deltaTime=this.time-this._previousTime,this.timeScale=this.deltaTime/.0166666667,this._previousTime=this.time,this.dispatch()}}var Ticker$1=new Ticker;class LoopElement extends HTMLElement{constructor({autoplay:e=!1,background:t=!1}={}){super(),this._autoplay=e||this.hasAttribute("autoplay"),this._background=t||this.hasAttribute("background"),this.paused=!0,this._pausedByBlur=!1,this._updateBinded=this.update.bind(this)}connectedCallback(){this._background||(window.top.addEventListener("blur",this._onBlur=()=>{this._pausedByBlur=!this.paused,this.pause()}),window.top.addEventListener("focus",this._onFocus=()=>{this._pausedByBlur&&this.play()})),(window.top.document.hasFocus()||this._background)&&this._autoplay?this.play():this._autoplay&&(this._pausedByBlur=!0,requestAnimationFrame(this._updateBinded))}disconnectedCallback(){this.pause(),window.top.removeEventListener("blur",this._onBlur),window.top.removeEventListener("focus",this._onFocus)}play(){this.paused=!1,this._pausedByBlur=!1,Ticker$1.add(this._updateBinded),this.dispatchEvent(new Event("playing"))}pause(){this.paused=!0,Ticker$1.delete(this._updateBinded),this.dispatchEvent(new Event("pause"))}update(){}}window.customElements.define("dlib-loop",LoopElement);const EPSILON=1e-6;let ARRAY_TYPE="undefined"==typeof Float32Array?Array:Float32Array;const degree=Math.PI/180;function copy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function set(e,t,n,a,r,i,d,o,s,l,_,u,c,m,g,p,f){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e[4]=i,e[5]=d,e[6]=o,e[7]=s,e[8]=l,e[9]=_,e[10]=u,e[11]=c,e[12]=m,e[13]=g,e[14]=p,e[15]=f,e}function identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function invert(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=t[4],o=t[5],s=t[6],l=t[7],_=t[8],u=t[9],c=t[10],m=t[11],g=t[12],p=t[13],f=t[14],h=t[15],v=n*o-a*d,y=n*s-r*d,x=n*l-i*d,E=a*s-r*o,b=a*l-i*o,T=r*l-i*s,S=_*p-u*g,B=_*f-c*g,P=_*h-m*g,w=u*f-c*p,C=u*h-m*p,R=c*h-m*f,A=v*R-y*C+x*w+E*P-b*B+T*S;return A?(A=1/A,e[0]=(o*R-s*C+l*w)*A,e[1]=(r*C-a*R-i*w)*A,e[2]=(p*T-f*b+h*E)*A,e[3]=(c*b-u*T-m*E)*A,e[4]=(s*P-d*R-l*B)*A,e[5]=(n*R-r*P+i*B)*A,e[6]=(f*x-g*T-h*y)*A,e[7]=(_*T-c*x+m*y)*A,e[8]=(d*C-o*P+l*S)*A,e[9]=(a*P-n*C-i*S)*A,e[10]=(g*b-p*x+h*v)*A,e[11]=(u*x-_*b-m*v)*A,e[12]=(o*B-d*w-s*S)*A,e[13]=(n*w-a*B+r*S)*A,e[14]=(p*y-g*E-f*v)*A,e[15]=(_*E-u*y+c*v)*A,e):null}function multiply(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=t[9],m=t[10],g=t[11],p=t[12],f=t[13],h=t[14],v=t[15],y=n[0],x=n[1],E=n[2],b=n[3];return e[0]=y*a+x*o+E*u+b*p,e[1]=y*r+x*s+E*c+b*f,e[2]=y*i+x*l+E*m+b*h,e[3]=y*d+x*_+E*g+b*v,y=n[4],x=n[5],E=n[6],b=n[7],e[4]=y*a+x*o+E*u+b*p,e[5]=y*r+x*s+E*c+b*f,e[6]=y*i+x*l+E*m+b*h,e[7]=y*d+x*_+E*g+b*v,y=n[8],x=n[9],E=n[10],b=n[11],e[8]=y*a+x*o+E*u+b*p,e[9]=y*r+x*s+E*c+b*f,e[10]=y*i+x*l+E*m+b*h,e[11]=y*d+x*_+E*g+b*v,y=n[12],x=n[13],E=n[14],b=n[15],e[12]=y*a+x*o+E*u+b*p,e[13]=y*r+x*s+E*c+b*f,e[14]=y*i+x*l+E*m+b*h,e[15]=y*d+x*_+E*g+b*v,e}function translate(e,t,n){let a,r,i,d,o,s,l,_,u,c,m,g,p=n[0],f=n[1],h=n[2];return t===e?(e[12]=t[0]*p+t[4]*f+t[8]*h+t[12],e[13]=t[1]*p+t[5]*f+t[9]*h+t[13],e[14]=t[2]*p+t[6]*f+t[10]*h+t[14],e[15]=t[3]*p+t[7]*f+t[11]*h+t[15]):(a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=t[9],m=t[10],g=t[11],e[0]=a,e[1]=r,e[2]=i,e[3]=d,e[4]=o,e[5]=s,e[6]=l,e[7]=_,e[8]=u,e[9]=c,e[10]=m,e[11]=g,e[12]=a*p+o*f+u*h+t[12],e[13]=r*p+s*f+c*h+t[13],e[14]=i*p+l*f+m*h+t[14],e[15]=d*p+_*f+g*h+t[15]),e}function scale(e,t,n){let a=n[0],r=n[1],i=n[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rotateX(e,t,n){var a=Math.cos,r=Math.sin;let i=r(n),d=a(n),o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=t[9],m=t[10],g=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*d+u*i,e[5]=s*d+c*i,e[6]=l*d+m*i,e[7]=_*d+g*i,e[8]=u*d-o*i,e[9]=c*d-s*i,e[10]=m*d-l*i,e[11]=g*d-_*i,e}function rotateY(e,t,n){var a=Math.cos,r=Math.sin;let i=r(n),d=a(n),o=t[0],s=t[1],l=t[2],_=t[3],u=t[8],c=t[9],m=t[10],g=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*d-u*i,e[1]=s*d-c*i,e[2]=l*d-m*i,e[3]=_*d-g*i,e[8]=o*i+u*d,e[9]=s*i+c*d,e[10]=l*i+m*d,e[11]=_*i+g*d,e}function rotateZ(e,t,n){var a=Math.cos,r=Math.sin;let i=r(n),d=a(n),o=t[0],s=t[1],l=t[2],_=t[3],u=t[4],c=t[5],m=t[6],g=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*d+u*i,e[1]=s*d+c*i,e[2]=l*d+m*i,e[3]=_*d+g*i,e[4]=u*d-o*i,e[5]=c*d-s*i,e[6]=m*d-l*i,e[7]=g*d-_*i,e}function fromQuat(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n+n,o=a+a,s=r+r,l=n*d,_=a*d,u=a*o,c=r*d,m=r*o,g=r*s,p=i*d,f=i*o,h=i*s;return e[0]=1-u-g,e[1]=_+h,e[2]=c-f,e[3]=0,e[4]=_-h,e[5]=1-l-g,e[6]=m+p,e[7]=0,e[8]=c+f,e[9]=m-p,e[10]=1-l-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function perspective(e,t,n,a,r){var i=Math.tan;let d,o=1/i(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(d=1/(a-r),e[10]=(r+a)*d,e[14]=2*r*a*d):(e[10]=-1,e[14]=-2*a),e}class Matrix4 extends Float32Array{constructor(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return super(e),this}set x(e){this[12]=e}get x(){return this[12]}set y(e){this[13]=e}get y(){return this[13]}set z(e){this[14]=e}get z(){return this[14]}set w(e){this[15]=e}get w(){return this[15]}set(e,t,n,a,r,i,d,o,s,l,_,u,c,m,g,p){return e.length?this.copy(e):(set(this,e,t,n,a,r,i,d,o,s,l,_,u,c,m,g,p),this)}translate(e,t=this){return translate(this,t,e),this}rotateX(e,t=this){return rotateX(this,t,e),this}rotateY(e,t=this){return rotateY(this,t,e),this}rotateZ(e,t=this){return rotateZ(this,t,e),this}scale(e,t=this){return scale(this,t,"number"==typeof e?[e,e,e]:e),this}multiply(e,t){return t?multiply(this,e,t):multiply(this,this,e),this}identity(){return identity(this),this}copy(e){return copy(this,e),this}fromPerspective({fov:e,aspectRatio:t,near:n,far:a}={}){return perspective(this,e,t,n,a),this}fromQuaternion(e){return fromQuat(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}invert(e=this){return invert(this,e),this}}function create$1(){let e=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function copy$1(e,t){return e[0]=t[0],e[1]=t[1],e}function set$1(e,t,n){return e[0]=t,e[1]=n,e}function add$1(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function subtract$1(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function scale$1(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function length(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function squaredLength(e){var t=e[0],n=e[1];return t*t+n*n}function negate(e,t){return e[0]=-t[0],e[1]=-t[1],e}function normalize(e,t){var n=Math.sqrt,a=t[0],r=t[1],i=a*a+r*r;return 0<i&&(i=1/n(i),e[0]=t[0]*i,e[1]=t[1]*i),e}function dot(e,t){return e[0]*t[0]+e[1]*t[1]}function cross(e,t,n){var a=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=a,e}function lerp(e,n,a,r){var t=n[0],i=n[1];return e[0]=t+r*(a[0]-t),e[1]=i+r*(a[1]-i),e}function transformMat3(e,t,n){var a=t[0],r=t[1];return e[0]=n[0]*a+n[3]*r+n[6],e[1]=n[1]*a+n[4]*r+n[7],e}function transformMat4(e,t,n){let a=t[0],r=t[1];return e[0]=n[0]*a+n[4]*r+n[12],e[1]=n[1]*a+n[5]*r+n[13],e}function exactEquals$1(e,t){return e[0]===t[0]&&e[1]===t[1]}const forEach=function(){var e=Math.min;let t=create$1();return function(n,a,r,d,o,s){let _,u;for(a||(a=2),r||(r=0),u=d?e(d*a+r,n.length):n.length,_=r;_<u;_+=a)t[0]=n[_],t[1]=n[_+1],o(t,t,s),n[_]=t[0],n[_+1]=t[1];return n}}();class Vector2 extends Float32Array{constructor(e=[0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}set(e,t){return set$1(this,e,t),this}copy(e){return copy$1(this,e),this}add(e){return add$1(this,this,e),this}get size(){return length(this)}get squaredSize(){return squaredLength(this)}subtract(e){return subtract$1(this,this,e),this}negate(e=this){return negate(this,e),this}cross(e,t){return cross(this,e,t),this}scale(e){return scale$1(this,this,e),this}normalize(){normalize(this,this)}dot(e){return dot(this,e)}equals(e){return exactEquals$1(this,e)}applyMatrix3(e){return transformMat3(this,this,e),this}applyMatrix4(e){return transformMat4(this,this,e),this}lerp(e,t){lerp(this,this,e,t)}clone(){return new Vector2(this)}}function create$2(){let e=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function length$1(e){let t=e[0],n=e[1],a=e[2];return Math.sqrt(t*t+n*n+a*a)}function fromValues$2(e,t,n){let a=new ARRAY_TYPE(3);return a[0]=e,a[1]=t,a[2]=n,a}function copy$2(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function set$2(e,t,n,a){return e[0]=t,e[1]=n,e[2]=a,e}function add$2(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function subtract$2(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function scale$2(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function distance$1(e,t){let n=t[0]-e[0],a=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+a*a+r*r)}function squaredLength$1(e){let t=e[0],n=e[1],a=e[2];return t*t+n*n+a*a}function negate$1(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function normalize$1(e,t){var n=Math.sqrt;let a=t[0],r=t[1],i=t[2],d=a*a+r*r+i*i;return 0<d&&(d=1/n(d),e[0]=t[0]*d,e[1]=t[1]*d,e[2]=t[2]*d),e}function dot$1(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cross$1(e,t,n){let a=t[0],r=t[1],i=t[2],d=n[0],o=n[1],s=n[2];return e[0]=r*s-i*o,e[1]=i*d-a*s,e[2]=a*o-r*d,e}function transformMat4$1(e,t,n){let a=t[0],r=t[1],i=t[2],d=n[3]*a+n[7]*r+n[11]*i+n[15];return d=d||1,e[0]=(n[0]*a+n[4]*r+n[8]*i+n[12])/d,e[1]=(n[1]*a+n[5]*r+n[9]*i+n[13])/d,e[2]=(n[2]*a+n[6]*r+n[10]*i+n[14])/d,e}function angle$1(e,t){var n=Math.acos,a=Math.PI;let r=fromValues$2(e[0],e[1],e[2]),i=fromValues$2(t[0],t[1],t[2]);normalize$1(r,r),normalize$1(i,i);let d=dot$1(r,i);return 1<d?0:-1>d?a:n(d)}function exactEquals$2(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}const len$1=length$1,forEach$1=function(){var e=Math.min;let t=create$2();return function(n,a,r,d,o,s){let _,u;for(a||(a=3),r||(r=0),u=d?e(d*a+r,n.length):n.length,_=r;_<u;_+=a)t[0]=n[_],t[1]=n[_+1],t[2]=n[_+2],o(t,t,s),n[_]=t[0],n[_+1]=t[1],n[_+2]=t[2];return n}}();class Vector3 extends Float32Array{constructor(e=[0,0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}set(e,t,n){return set$2(this,e,t,n),this}copy(e){return copy$2(this,e),this}add(e){return add$2(this,this,e),this}get size(){return length$1(this)}get squaredSize(){return squaredLength$1(this)}distance(e){return distance$1(this,e)}subtract(e){return subtract$2(this,this,e),this}negate(e=this){return negate$1(this,e),this}cross(e,t){return cross$1(this,e,t),this}scale(e){return scale$2(this,this,e),this}normalize(){return normalize$1(this,this),this}dot(e){return dot$1(this,e)}equals(e){return exactEquals$2(this,e)}applyMatrix4(e){return transformMat4$1(this,this,e),this}angle(e){return angle$1(this,e)}clone(){return new Vector3(this)}}function create$3(){let e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function copy$3(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function set$3(e,t,n,a,r){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e}function normalize$2(e,t){var n=Math.sqrt;let a=t[0],r=t[1],i=t[2],d=t[3],o=a*a+r*r+i*i+d*d;return 0<o&&(o=1/n(o),e[0]=a*o,e[1]=r*o,e[2]=i*o,e[3]=d*o),e}const forEach$2=function(){var e=Math.min;let t=create$3();return function(n,a,r,d,o,s){let _,u;for(a||(a=4),r||(r=0),u=d?e(d*a+r,n.length):n.length,_=r;_<u;_+=a)t[0]=n[_],t[1]=n[_+1],t[2]=n[_+2],t[3]=n[_+3],o(t,t,s),n[_]=t[0],n[_+1]=t[1],n[_+2]=t[2],n[_+3]=t[3];return n}}();class Vector4 extends Float32Array{constructor(e=[0,0,0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}set(e,t,n,a){return set$3(this,e,t,n,a),this}}function create$4(){let e=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function fromMat4(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function copy$4(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function set$4(e,t,n,a,r,i,d,o,s,l){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e[4]=i,e[5]=d,e[6]=o,e[7]=s,e[8]=l,e}function identity$1(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function invert$1(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=t[4],o=t[5],s=t[6],l=t[7],_=t[8],u=_*d-o*l,c=-_*i+o*s,m=l*i-d*s,g=n*u+a*c+r*m;return g?(g=1/g,e[0]=u*g,e[1]=(-_*a+r*l)*g,e[2]=(o*a-r*d)*g,e[3]=c*g,e[4]=(_*n-r*s)*g,e[5]=(-o*n+r*i)*g,e[6]=m*g,e[7]=(-l*n+a*s)*g,e[8]=(d*n-a*i)*g,e):null}function multiply$4(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=n[0],m=n[1],g=n[2],p=n[3],f=n[4],h=n[5],v=n[6],y=n[7],x=n[8];return e[0]=c*a+m*d+g*l,e[1]=c*r+m*o+g*_,e[2]=c*i+m*s+g*u,e[3]=p*a+f*d+h*l,e[4]=p*r+f*o+h*_,e[5]=p*i+f*s+h*u,e[6]=v*a+y*d+x*l,e[7]=v*r+y*o+x*_,e[8]=v*i+y*s+x*u,e}function translate$1(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],u=t[8],c=n[0],m=n[1];return e[0]=a,e[1]=r,e[2]=i,e[3]=d,e[4]=o,e[5]=s,e[6]=c*a+m*d+l,e[7]=c*r+m*o+_,e[8]=c*i+m*s+u,e}function rotate$2(e,t,n){var a=Math.cos,r=Math.sin;let i=t[0],d=t[1],o=t[2],l=t[3],_=t[4],u=t[5],m=t[6],g=t[7],p=t[8],f=r(n),s=a(n);return e[0]=s*i+f*l,e[1]=s*d+f*_,e[2]=s*o+f*u,e[3]=s*l-f*i,e[4]=s*_-f*d,e[5]=s*u-f*o,e[6]=m,e[7]=g,e[8]=p,e}function scale$4(e,t,n){let a=n[0],r=n[1];return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function fromQuat$1(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n+n,o=a+a,s=r+r,l=n*d,_=a*d,u=a*o,c=r*d,m=r*o,g=r*s,p=i*d,f=i*o,h=i*s;return e[0]=1-u-g,e[3]=_-h,e[6]=c+f,e[1]=_+h,e[4]=1-l-g,e[7]=m-p,e[2]=c-f,e[5]=m+p,e[8]=1-l-u,e}class Matrix3 extends Float32Array{constructor(e=[1,0,0,0,1,0,0,0,1]){return super(e),this}set(e,t,n,a,r,i,d,o,s){return set$4(this,e,t,n,a,r,i,d,o,s),this}translate(e,t=this){return translate$1(this,t,e),this}rotate(e,t=this){return rotate$2(this,t,e),this}scale(e,t=this){return scale$4(this,t,e),this}multiply(e,t){return t?multiply$4(this,e,t):multiply$4(this,this,e),this}identity(){return identity$1(this),this}copy(e){return copy$4(this,e),this}fromMatrix4(e){return fromMat4(this,e),this}fromQuaternion(e){return fromQuat$1(this,e),this}fromBasis(e,t,n){return this.set(e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2]),this}invert(e=this){return invert$1(this,e),this}}class Shader{static add(e="void main() {}",t){for(let[n,a]of t)e="start"===n?e.replace(/(#version .*?\n(\s*precision highp float;\s)?)([\s\S]*)/,`$1\n${a}\n$3`):"end"===n?e.replace(/(}\s*$)/,`\n${a}\n$1`):"main"===n?e.replace(/(\bvoid\b +\bmain\b[\s\S]*?{\s*)/,`$1\n${a}\n`):e.replace(n,a);return e}constructor({vertexShader:e=`#version 300 es
      void main() {
        gl_Position = vec4(0., 0., 0., 1.);
      }
    `,fragmentShader:t=`#version 300 es
      precision highp float;

      out vec4 fragColor;

      void main() {
        fragColor = vec4(1.);
      }
    `,dataTypeConctructors:n={Vector2:class extends Float32Array{constructor(){super(2)}},Vector3:class extends Float32Array{constructor(){super(3)}},Vector4:class extends Float32Array{constructor(){super(4)}},Matrix3:class extends Float32Array{constructor(){super([1,0,0,0,1,0,0,0,1])}},Matrix4:class extends Float32Array{constructor(){super([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Texture:class{},TextureCube:class{}},uniforms:a=[],vertexShaderChunks:r=[],fragmentShaderChunks:i=[],shaders:d=[]}={}){this.uniforms=new Map,this.uniformTypes=new Map,this.vertexShader=e,this.fragmentShader=t,this._vertexShaderChunks=[],this._fragmentShaderChunks=[],this._dataTypeConctructors=n,this.add({vertexShaderChunks:r,fragmentShaderChunks:i,uniforms:a});for(let o of d)this.add(o)}add({vertexShaderChunks:e=[],fragmentShaderChunks:t=[],uniforms:n=[]}={}){this.vertexShader=Shader.add(this.vertexShader,e),this._vertexShaderChunks.push(...e),this.fragmentShader=Shader.add(this.fragmentShader,t),this._fragmentShaderChunks.push(...t);for(let[a,r]of n)this.uniforms.set(a,r)}set vertexShader(e){this._vertexShader=e,this._parseUniforms(this._vertexShader)}get vertexShader(){return this._vertexShader}set fragmentShader(e){this._fragmentShader=e,this._parseUniforms(this._fragmentShader)}get fragmentShader(){return this._fragmentShader}get vertexShaderChunks(){return this._vertexShaderChunks}get fragmentShaderChunks(){return this._fragmentShaderChunks}_addUniform(e,t,n){if(this.uniforms.has(e))return;let a,r;if(this.uniformTypes.set(e,t),/float|double/.test(t))a=isNaN(n)?0:Array(n).fill(0);else if(/int|uint/.test(t))a=isNaN(n)?0:Array(n).fill(0);else if(/sampler2D/.test(t))a=isNaN(n)?new this._dataTypeConctructors.Texture:Array(n).fill().map(()=>new this._dataTypeConctructors.Texture);else if(/samplerCube/.test(t))a=isNaN(n)?new this._dataTypeConctructors.TextureCube:Array(n).fill().map(()=>new this._dataTypeConctructors.TextureCube);else if(r=/(.?)vec(\d)/.exec(t)){let e=r[2];a=isNaN(n)?new this._dataTypeConctructors[`Vector${e}`]:Array(n).fill().map(()=>new this._dataTypeConctructors[`Vector${e}`])}else if(r=/mat(\d)/.exec(t)){let e=r[1];a=isNaN(n)?new this._dataTypeConctructors[`Matrix${e}`]:Array(n).fill().map(()=>new this._dataTypeConctructors[`Matrix${e}`])}else a=void 0;this.uniforms.set(e,a)}_parseUniforms(e){const t=new Map,n=/struct\s*(.*)\s*{\s*([\s\S]*?)}/g,a=/^\s*(.[^ ]+) (.[^ ;\[\]]+)\[? *(\d+)? *\]?/gm;for(let r;r=n.exec(e);){const e=r[1],n=r[2],i={};for(let e;e=a.exec(n);){const[,t,n,a]=e,r=parseInt(a);i[n]={type:t,arrayLength:r}}t.set(e,i)}const r=/^\s*uniform (.[^ ]+) (.[^ ;\[\]]+)\[? *(\d+)? *\]?/gm;for(let n;n=r.exec(e);){const[,e,a,r]=n,i=parseInt(r),d=t.get(e);if(d)for(const e in d)this._addUniform(`${a}.${e}`,d[e].type,d[e].arrayLength);else this._addUniform(a,e,i)}}}class GLTexture{constructor({gl:e,data:t=void 0,width:n=void 0,height:a=void 0,target:r=t&&t.length?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,level:i=0,internalFormat:d=e.RGBA8||e.RGBA,format:o=e.RGBA,type:s=e.UNSIGNED_BYTE,minFilter:l=e.NEAREST_MIPMAP_LINEAR,magFilter:_=e.LINEAR,wrapS:u=e.REPEAT,wrapT:c=e.REPEAT}={gl:e}){this.gl=e,this._texture=this.gl.createTexture(),this._width=n,this._height=a,this._dataWidth=void 0,this._dataHeight=void 0,this._target=r,this.level=i,this.internalFormat=d,this.format=o,this.type=s,this.minFilter=l,this.magFilter=_,this.wrapS=u,this.wrapT=c,this.data=t}generateMipmap(){this.bind(),this.gl.generateMipmap(this._target),this.unbind()}set data(e){if(this._data=e,!this._data&&!(this._width&&this._height))return;const t=this._data&&this._data.length?this._data:[this._data];t[0]&&(this._dataWidth=t[0].width||t[0].videoWidth,this._dataHeight=t[0].height||t[0].videoHeight);const n=this._target===this.gl.TEXTURE_CUBE_MAP?6:1,a=this._target===this.gl.TEXTURE_CUBE_MAP?this.gl.TEXTURE_CUBE_MAP_POSITIVE_X:this._target;this.bind();for(let n=0;n<t.length;n++)this.gl.getParameter(this.gl.VERSION).startsWith("WebGL 1.0")&&this._dataWidth?this.gl.texImage2D(a+n,this.level,this.internalFormat,this.format,this.type,t[n]):this.gl.texImage2D(a+n,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,t[n]);this.unbind()}get data(){return this._data}set width(e){this._width=e,this.data=this.data}get width(){return this._width||this._dataWidth}set height(e){this._height=e,this.data=this.data}get height(){return this._height||this._dataHeight}set minFilter(e){this._minFilter===e||(this._minFilter=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MIN_FILTER,this._minFilter),this.unbind())}get minFilter(){return this._minFilter}set magFilter(e){this._magFilter===e||(this._magFilter=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MAG_FILTER,this._magFilter),this.unbind())}get magFilter(){return this._magFilter}set wrapS(e){this._wrapS===e||(this._wrapS=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_S,this._wrapS),this.unbind())}get wrapS(){return this._wrapS}set wrapT(e){this._wrapT===e||(this._wrapT=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_T,this._wrapT),this.unbind())}get wrapT(){return this._wrapT}bind({unit:e=0}={}){this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this._target,this._texture)}unbind(){this.gl.bindTexture(this._target,null)}clone(){return new GLTexture(this)}}class GLProgram extends Shader{constructor({gl:e,vertexShader:t=void 0,fragmentShader:n=void 0,uniforms:a=void 0,attributes:r=void 0,transformFeedbackVaryings:i=void 0,vertexShaderChunks:d=void 0,fragmentShaderChunks:o=void 0,shaders:s=void 0}={gl:e}){super({vertexShader:t,fragmentShader:n,uniforms:a,vertexShaderChunks:d,fragmentShaderChunks:o,shaders:s,dataTypeConctructors:{Vector2,Vector3,Vector4,Matrix3,Matrix4,Texture:class{},TextureCube:class{}}}),this.gl=e,this._program=e.createProgram(),this._attachedShaders=new Map;const l=this;this._vertexAttribDivisor=function(){};const _=this.gl.getExtension("ANGLE_instanced_arrays");_?this._vertexAttribDivisor=_.vertexAttribDivisorANGLE.bind(_):this.gl.vertexAttribDivisor&&(this._vertexAttribDivisor=this.gl.vertexAttribDivisor.bind(this.gl));class u extends Map{set(t,{buffer:n,location:r=l._attributesLocations.get(t),size:a,type:i=e.FLOAT,normalized:d=!1,stride:o=0,offset:s=0,divisor:_=0}={}){if(t instanceof Map){for(let[e,n]of t)this.set(e,n);return}n.bind(),r===void 0&&(r=e.getAttribLocation(l._program,t),-1===r&&console.warn(`Attribute "${t}" is missing or never used`),l._attributesLocations.set(t,r)),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,a,i,d,o,s),n.unbind(),l._vertexAttribDivisor(r,_),super.set(t,{buffer:n,size:a,type:i,normalized:d,stride:o,offset:s})}}class c extends Map{set(t,...n){let a=n[0];if(void 0===a)return;let r=l._uniformLocations.get(t);r===void 0&&(r=e.getUniformLocation(l._program,t),l._uniformLocations.set(t,r));let i;if(a.length===void 0){if(a instanceof GLTexture){let e=0;for(const[r,d]of l.uniformTypes)if(d.startsWith("sampler")){if(r===t){i=a,n=[e];break}e++}}else if(a instanceof Object){for(let e in a)l.uniforms.set(`${t}.${e}`,a[e]);return}1<n.length?(a=l.uniforms.get(t),a.set(...n)):a=n}else if(a[0]instanceof Object){for(let e=0;e<a.length;e++)if(a[0].length)l.uniforms.set(`${t}[${e}]`,a[e]);else for(let n in a[e])l.uniforms.set(`${t}[${e}].${n}`,a[e][n]);return}if(null!==r){const n=l.uniformTypes.get(t);"float"===n||"bool"===n?e.uniform1fv(r,a):"vec2"===n?e.uniform2fv(r,a):"vec3"===n?e.uniform3fv(r,a):"vec4"===n?e.uniform4fv(r,a):"int"===n||n.startsWith("sampler")?e.uniform1iv(r,a):"ivec2"===n?e.uniform2iv(r,a):"ivec3"===n?e.uniform3iv(r,a):"ivec4"===n?e.uniform4iv(r,a):"mat3"===n?e.uniformMatrix3fv(r,!1,a):"mat4"===n&&e.uniformMatrix4fv(r,!1,a),super.set(t,i||a)}}}i&&this.gl.transformFeedbackVaryings(this._program,i,e.INTERLEAVED_ATTRIBS),this.vertexShader=this.vertexShader,this.fragmentShader=this.fragmentShader,this.use(),this.attributes=new u;const m=this.uniforms;this.uniforms=new c;for(const[l,_]of m)this.uniforms.set(l,_)}set vertexShader(e){super.vertexShader=e,this.gl&&this._updateShader(this.gl.VERTEX_SHADER,this.vertexShader)}get vertexShader(){return super.vertexShader}set fragmentShader(e){super.fragmentShader=e,this.gl&&this._updateShader(this.gl.FRAGMENT_SHADER,this.fragmentShader)}get fragmentShader(){return super.fragmentShader}use(){this.gl.useProgram(this._program)}_updateShader(e,t){if(t){if(this.gl.getParameter(this.gl.VERSION).startsWith("WebGL 1.0"))if(t=t.replace(/#version.*?\n/g,""),t=t.replace(/\btexture\b/g,"texture2D"),e===this.gl.VERTEX_SHADER)t=t.replace(/\bin\b/g,"attribute"),t=t.replace(/\bout\b/g,"varying");else{t=t.replace(/\bin\b/g,"varying");const e=/out vec4 (.*?);/.exec(t);if(e){const n=e[1];t=t.replace(/out.*?;/,""),t=t.replace(new RegExp(`\\b${n}\\b`,"g"),"gl_FragColor")}}const n=this.gl.createShader(e);this.gl.shaderSource(n,t),this.gl.compileShader(n);const a=this.gl.getShaderInfoLog(n);if(!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)){const e=/ERROR: 0:(\d+):/.exec(a);if(e){const n=parseFloat(e[1]),r=t.split("\n");throw new Error(`${a}\nat: ${r[n-1].replace(/^\s*/,"")}`)}else throw new Error(a);return void this.gl.deleteShader(n)}a&&console.warn(a);const r=this._attachedShaders.get(e);if(r&&(this.gl.detachShader(this._program,r),this.gl.deleteShader(r)),this.gl.attachShader(this._program,n),this.gl.deleteShader(n),this._attachedShaders.set(e,n),2===this._attachedShaders.size){this.gl.linkProgram(this._program);const e=this.gl.getProgramInfoLog(this._program);if(!this.gl.getProgramParameter(this._program,this.gl.LINK_STATUS))throw new Error(e);else e&&console.warn(e);this._attributesLocations=new Map,this._uniformLocations=new Map}}}}class GLBuffer{constructor({gl:e,data:t=null,target:n=e.ARRAY_BUFFER,usage:a=e.STATIC_DRAW}={gl:e}){this.gl=e,this.target=n,this.usage=a,this._buffer=this.gl.createBuffer(),t&&(this.data=t)}set data(e){this._data=e,this.bind(),this.gl.bufferData(this.target,this._data,this.usage),this.unbind()}get data(){return this._data}bind({target:e=this.target,index:t=void 0,offset:n=0,size:a=void 0}={}){t===void 0?this.gl.bindBuffer(e,this._buffer):a===void 0?this.gl.bindBufferBase(e,t,this._buffer):this.gl.bindBufferRange(e,t,this._buffer,n,a)}unbind({target:e=this.target,index:t=void 0,offset:n=0,size:a=void 0}={}){t===void 0?this.gl.bindBuffer(e,null):a===void 0?this.gl.bindBufferBase(e,t,null):this.gl.bindBufferRange(e,t,null,n,a)}}class GLVertexAttribute{constructor({gl:e,data:t=void 0,buffer:n=new GLBuffer({gl:e}),size:a=1,type:r=void 0,offset:i=0,normalized:d=!1,stride:o=0,count:s=void 0,divisor:l=0}={gl:e}){this.gl=e,this.buffer=n,this.size=a,this.type=r,this.offset=i,this.normalized=d,this.stride=o,this.count=s,this.divisor=l,t&&(this.data=t)}set count(e){this._count=e}get count(){return this._count===void 0?this.data.length/this.size:this._count}set type(e){this._type=e}get type(){let e=this._type;return e||(this.data instanceof Float32Array||this.data instanceof Float64Array?e=this.gl.FLOAT:this.data instanceof Uint8Array?e=this.gl.UNSIGNED_BYTE:this.data instanceof Uint16Array?e=this.gl.UNSIGNED_SHORT:this.data instanceof Uint32Array&&(e=this.gl.UNSIGNED_INT)),e}set data(e){this.buffer.data=e}get data(){return this.buffer.data}}class GLMesh{constructor({gl:e,attributes:t=void 0,indices:n=void 0}={gl:e}){this.gl=e,this.gl.getExtension("OES_element_index_uint"),this._drawElementsInstanced=function(){},this._drawArraysInstanced=function(){};const a=this.gl.getExtension("ANGLE_instanced_arrays");a?(this._drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a)):this.gl.drawElementsInstanced&&(this._drawElementsInstanced=this.gl.drawElementsInstanced.bind(this.gl),this._drawArraysInstanced=this.gl.drawArraysInstanced.bind(this.gl)),this.attributes=new Map(t);for(const[a,r]of this.attributes)r instanceof GLVertexAttribute||this.attributes.set(a,new GLVertexAttribute(Object.assign({gl:e},r)));n&&!(this.indices instanceof GLVertexAttribute)&&(this.indices=new GLVertexAttribute(Object.assign({gl:this.gl,buffer:new GLBuffer({gl:this.gl,target:this.gl.ELEMENT_ARRAY_BUFFER})},n.length===void 0?n:{data:n})))}draw({mode:e=this.gl.TRIANGLES,elements:t=!!this.indices,count:n=t?this.indices.count:this.attributes.get("position").count,offset:a=this.indices?this.indices.offset:0,type:r=t?this.indices.type:null,first:i=0,instanceCount:d=void 0}={}){t?d===void 0?this.gl.drawElements(e,n,r,a):this._drawElementsInstanced(e,n,r,a,d):d===void 0?this.gl.drawArrays(e,i,n):this._drawArraysInstanced(e,i,n,d)}}class GLVertexArray{constructor({gl:e,mesh:t=void 0,program:n=void 0}={gl:e}){this.gl=e;const a=e.getExtension("OES_vertex_array_object");a&&(this.gl.createVertexArray=a.createVertexArrayOES.bind(a),this.gl.bindVertexArray=a.bindVertexArrayOES.bind(a)),this._vertexArray=this.gl.createVertexArray(),(t||n)&&this.add({mesh:t,program:n})}add({mesh:e=void 0,program:t=void 0}={}){this.bind(),t.attributes.set(e.attributes),e.indices&&e.indices.buffer.bind(),this.unbind()}bind(){this.gl.bindVertexArray(this._vertexArray)}unbind(){this.gl.bindVertexArray(null)}}class Camera{constructor({near:e=.01,far:t=1e3,aspectRatio:n=1,fov:a=Math.PI/3}={}){this._near=e,this._far=t,this._aspectRatio=n,this._fov=a,this.transform=new Matrix4,this._inverseTransform=new Matrix4,this._projection=new Matrix4,this._projectionView=new Matrix4,this._updateProjection()}set near(e){this._near=e,this._updateProjection()}get near(){return this._near}set far(e){this._far=e,this._updateProjection()}get far(){return this._far}set fov(e){this._fov=e,this._updateProjection()}get fov(){return this._fov}set aspectRatio(e){this._aspectRatio=e,this._updateProjection()}get aspectRatio(){return this._aspectRatio}get inverseTransform(){return this._inverseTransform.invert(this.transform)}get projection(){return this._projection}get projectionView(){return this._projectionView.copy(this.projection).multiply(this.inverseTransform)}_updateProjection(){this._projection.fromPerspective(this)}}Object.defineProperty(Camera.prototype,"near",{enumerable:!0}),Object.defineProperty(Camera.prototype,"far",{enumerable:!0}),Object.defineProperty(Camera.prototype,"fov",{enumerable:!0}),Object.defineProperty(Camera.prototype,"aspectRatio",{enumerable:!0}),Object.defineProperty(Camera.prototype,"inverseTransform",{enumerable:!0}),Object.defineProperty(Camera.prototype,"projection",{enumerable:!0}),Object.defineProperty(Camera.prototype,"projectionView",{enumerable:!0});let pointers=new Map;class Pointer extends Vector2{static get TOUCH_TYPE(){return"touchtype"}static get MOUSE_TYPE(){return"mousetype"}static get(e=document.body){let t=pointers.get(e);return t||(t=new Pointer(e)),t}get downed(){return this._downed}constructor(e=document.body){super(),this.domElement=e,this.type=Pointer.TOUCH_TYPE,this.velocity=new Vector2,this.dragOffset=new Vector2,this.centered=new Vector2,this.centeredFlippedY=new Vector2,this.normalized=new Vector2,this.normalizedFlippedY=new Vector2,this.normalizedCentered=new Vector2,this.normalizedCenteredFlippedY=new Vector2,this._downed=!1,pointers.set(this.domElement,this),this.onDown=new Signal,this.onMove=new Signal,this.onUp=new Signal,this.onClick=new Signal,this.onTypeChange=new Signal,this._preventMouseTypeChange=!1,this._onPointerMoveBinded=this._onPointerMove.bind(this),this._onPointerDownBinded=this._onPointerDown.bind(this),this._onPointerUpBinded=this._onPointerUp.bind(this),this._updateBinded=this._update.bind(this),this._resizeBinded=this.resize.bind(this),this.resize(),this._position=new Vector2,this.enable()}resize(){this._domElementBoundingRect=this.domElement.getBoundingClientRect()}_onPointerDown(t){"touchstart"===t.type&&(this._preventMouseTypeChange=!0,this._changeType(Pointer.TOUCH_TYPE)),this._downed=!0,this.dragOffset.set(0,0),this.copy(this._position),this._onPointerEvent(t),this._updatePositions(),this.onDown.dispatch(t)}_onPointerMove(t){if("mousemove"===t.type){if(this._preventMouseTypeChange)return;this._changeType(Pointer.MOUSE_TYPE)}this._onPointerEvent(t),this.onMove.dispatch(t)}_onPointerUp(t){this._downed&&(this._downed=!1,this._onPointerEvent(t),this._updatePositions(),this.onUp.dispatch(t),4>this.dragOffset.length&&this.onClick.dispatch(t),clearTimeout(this._timeout),this._timeout=setTimeout(()=>{this._preventMouseTypeChange=!1},2e3))}_onPointerEvent(t){!!window.TouchEvent&&t instanceof window.TouchEvent&&("touchend"===t.type?t=t.changedTouches[0]:t=t.touches[0]),this._position.x=t.clientX-this._domElementBoundingRect.left,this._position.y=t.clientY-this._domElementBoundingRect.top}_changeType(e){this.type===e||(this.type=e,this.disable(),this.enable(),this.onTypeChange.dispatch(this.type))}_update(){(this.x||this.y)&&(this.velocity.x=this._position.x-this.x,this.velocity.y=this._position.y-this.y,this.downed&&this.dragOffset.add(this.velocity)),this._updatePositions()}_updatePositions(){this.x=this._position.x,this.y=this._position.y;(this.x||this.y)&&(this.centered.x=this.centeredFlippedY.x=this.x-.5*this._domElementBoundingRect.width,this.centered.y=this.centeredFlippedY.y=this.y-.5*this._domElementBoundingRect.height,this.centeredFlippedY.y*=-1,this.normalized.x=this.normalizedFlippedY.x=this.x/this._domElementBoundingRect.width,this.normalized.y=this.normalizedFlippedY.y=this.y/this._domElementBoundingRect.height,this.normalizedFlippedY.y=1-this.normalizedFlippedY.y,this.normalizedCentered.x=this.normalizedCenteredFlippedY.x=2*this.normalized.x-1,this.normalizedCentered.y=this.normalizedCenteredFlippedY.y=2*this.normalized.y-1,this.normalizedCenteredFlippedY.y*=-1)}enable(){this.disable(),this.resize(),this.type===Pointer.TOUCH_TYPE?(this.domElement.addEventListener("touchmove",this._onPointerMoveBinded),window.addEventListener("touchend",this._onPointerUpBinded)):(this.domElement.addEventListener("mousedown",this._onPointerDownBinded),window.addEventListener("mouseup",this._onPointerUpBinded)),this.domElement.addEventListener("touchstart",this._onPointerDownBinded),this.domElement.addEventListener("mousemove",this._onPointerMoveBinded),window.addEventListener("resize",this._resizeBinded),Ticker$1.add(this._updateBinded=this._updateBinded||this._update.bind(this))}disable(){Ticker$1.delete(this._updateBinded),this.domElement.removeEventListener("touchstart",this._onPointerDownBinded),this.domElement.removeEventListener("mousedown",this._onPointerDownBinded),this.domElement.removeEventListener("touchmove",this._onPointerMoveBinded),this.domElement.removeEventListener("mousemove",this._onPointerMoveBinded),window.removeEventListener("touchend",this._onPointerUpBinded),window.removeEventListener("mouseup",this._onPointerUpBinded),window.removeEventListener("resize",this._resizeBinded)}}function create$5(){let e=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function identity$2(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function setAxisAngle(e,t,n){var a=Math.cos,r=Math.sin;n*=.5;let i=r(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=a(n),e}function multiply$5(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=n[0],s=n[1],l=n[2],_=n[3];return e[0]=a*_+d*o+r*l-i*s,e[1]=r*_+d*s+i*o-a*l,e[2]=i*_+d*l+a*s-r*o,e[3]=d*_-a*o-r*s-i*l,e}function rotateX$2(e,t,n){var a=Math.cos,r=Math.sin;n*=.5;let i=t[0],d=t[1],o=t[2],s=t[3],l=r(n),_=a(n);return e[0]=i*_+s*l,e[1]=d*_+o*l,e[2]=o*_-d*l,e[3]=s*_-i*l,e}function rotateY$2(e,t,n){var a=Math.cos,r=Math.sin;n*=.5;let i=t[0],d=t[1],o=t[2],s=t[3],l=r(n),_=a(n);return e[0]=i*_-o*l,e[1]=d*_+s*l,e[2]=o*_+i*l,e[3]=s*_-d*l,e}function rotateZ$2(e,t,n){var a=Math.cos,r=Math.sin;n*=.5;let i=t[0],d=t[1],o=t[2],s=t[3],l=r(n),_=a(n);return e[0]=i*_+d*l,e[1]=d*_-i*l,e[2]=o*_+s*l,e[3]=s*_-o*l,e}function slerp(e,n,a,r){var t=Math.acos,i=Math.sin;let d,o,s,l,_,u=n[0],c=n[1],m=n[2],g=n[3],p=a[0],f=a[1],h=a[2],v=a[3];return o=u*p+c*f+m*h+g*v,0>o&&(o=-o,p=-p,f=-f,h=-h,v=-v),1-o>EPSILON?(d=t(o),s=i(d),l=i((1-r)*d)/s,_=i(r*d)/s):(l=1-r,_=r),e[0]=l*u+_*p,e[1]=l*c+_*f,e[2]=l*m+_*h,e[3]=l*g+_*v,e}function invert$2(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n*n+a*a+r*r+i*i,o=d?1/d:0;return e[0]=-n*o,e[1]=-a*o,e[2]=-r*o,e[3]=i*o,e}function fromMat3(e,t){var n=Math.sqrt;let a,r=t[0]+t[4]+t[8];if(0<r)a=n(r+1),e[3]=.5*a,a=.5/a,e[0]=(t[5]-t[7])*a,e[1]=(t[6]-t[2])*a,e[2]=(t[1]-t[3])*a;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let i=(r+1)%3,d=(r+2)%3;a=n(t[3*r+r]-t[3*i+i]-t[3*d+d]+1),e[r]=.5*a,a=.5/a,e[3]=(t[3*i+d]-t[3*d+i])*a,e[i]=(t[3*i+r]+t[3*r+i])*a,e[d]=(t[3*d+r]+t[3*r+d])*a}return e}const copy$5=copy$3,set$5=set$3,normalize$3=normalize$2,rotationTo=function(){let e=create$2(),t=fromValues$2(1,0,0),n=fromValues$2(0,1,0);return function(r,i,a){let d=dot$1(i,a);return-.999999>d?(cross$1(e,t,i),1e-6>len$1(e)&&cross$1(e,n,i),normalize$1(e,e),setAxisAngle(r,e,Math.PI),r):.999999<d?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(cross$1(e,i,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+d,normalize$3(r,r))}}(),sqlerp=function(){let e=create$5(),n=create$5();return function(r,i,a,o,s,d){return slerp(e,i,s,d),slerp(n,a,o,d),slerp(r,e,n,2*d*(1-d)),r}}(),setAxes=function(){let e=create$4();return function(t,n,a,r){return e[0]=a[0],e[3]=a[1],e[6]=a[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],normalize$3(t,fromMat3(t,e))}}();class Quaternion extends Float32Array{constructor(e=0,t=0,n=0,a=1){return super(4),this.set(e,t,n,a),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}identity(){return identity$2(this),this}set(e,t,n,a){return set$5(this,e,t,n,a),this}rotateX(e){return rotateX$2(this,this,e),this}rotateY(e){return rotateY$2(this,this,e),this}rotateZ(e){return rotateZ$2(this,this,e),this}invert(e=this){return invert$2(this,e),this}copy(e){return copy$5(this,e),this}normalize(e=this){return normalize$3(this,this),this}multiply(e,t){return t?multiply$5(this,e,t):multiply$5(this,this,e),this}fromMatrix3(e){return fromMat3(this,e),this}}class TrackballController{constructor({matrix:e=new Matrix4,domElement:t=document.body,distance:n=0,invertRotation:a=!0,rotationEaseRatio:r=.04,zoomSpeed:i=.1,zoomEaseRatio:d=.1,minDistance:o=0,maxDistance:s=1/0,enabled:l=!0}={}){this.matrix=e,this._distance=n,this.invertRotation=a,this.rotationEaseRatio=r,this.maxDistance=s,this.minDistance=o,this.zoomSpeed=i,this.zoomEaseRatio=d,this._pointer=Pointer.get(t),this._nextDistance=this._distance,this._cachedQuaternion=new Quaternion,this._cachedMatrix=new Matrix4,this._cachedVector3=new Vector3,this._velocity=new Vector2,this._velocityOrigin=new Vector2,this._position=new Vector3([this.matrix.x,this.matrix.y,this.matrix.z]),this._positionPrevious=this._position.clone(),this._positionOffset=new Vector3,t.addEventListener("wheel",this.onWheel.bind(this)),this.enabled=!0,this.update(),this.enabled=l}set distance(e){this._distance=this._nextDistance=e}get distance(){return this._distance}onWheel(t){var e=Math.max,n=Math.abs,a=Math.min;if(this.enabled){const r=1+n(.01*(t.deltaY*this.zoomSpeed));this._nextDistance=this._nextDistance||1,this._nextDistance=0<t.deltaY?this._nextDistance*r:this._nextDistance/r,this._nextDistance=e(a(this._nextDistance,this.maxDistance),this.minDistance)}}update(){this.enabled&&(this._cachedMatrix.identity(),this._cachedQuaternion.identity(),this._distance+=(this._nextDistance-this._distance)*this.zoomEaseRatio,this._position.set(this.matrix.x,this.matrix.y,this.matrix.z).subtract(this._positionOffset),this.matrix.x=0,this.matrix.y=0,this.matrix.z=0,this._pointer.downed&&this._velocity.copy(this._pointer.velocity).scale(.003),this._velocity.lerp(this._velocityOrigin,this.rotationEaseRatio),this._cachedQuaternion.rotateY(this.invertRotation?-this._velocity.x:this._velocity.x),this._cachedQuaternion.rotateX(this.invertRotation?-this._velocity.y:this._velocity.y),this._cachedMatrix.fromQuaternion(this._cachedQuaternion),this.matrix.multiply(this._cachedMatrix),this._positionOffset.set(0,0,1),this._positionOffset.applyMatrix4(this.matrix),this._positionOffset.scale(this._distance),this._cachedVector3.copy(this._position).add(this._positionOffset),this.matrix.x=this._cachedVector3.x,this.matrix.y=this._cachedVector3.y,this.matrix.z=this._cachedVector3.z)}}class View{constructor({canvas:e=void 0}={}){this.canvas=e;const t={depth:!0,alpha:!1,antialias:!0};/\bforcewebgl1\b/.test(window.location.search)||(this.gl=this.canvas.getContext("webgl2",t)),this.gl||(this.gl=this.canvas.getContext("webgl",t)||this.canvas.getContext("experimental-webgl",t)),this.camera=new Camera,this.cameraController=new TrackballController({matrix:this.camera.transform,distance:5}),this.gl.clearColor(0,0,0,1),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST),this.program=new GLProgram({gl:this.gl,uniforms:[["transform",new Matrix4]],vertexShaderChunks:[["start",`
          uniform mat4 projectionView;
          uniform mat4 transform;

          in vec3 normal;
          in vec3 position;

          out vec3 vNormal;
        `],["end",`
          gl_Position = projectionView * transform * vec4(position, 1.);
          vNormal = normal;
        `]],fragmentShaderChunks:[["start",`
          precision highp float;

          in vec3 vNormal;
        `],["end",`
          fragColor = vec4(vNormal * .5 + .5, 1.);
        `]]}),this.mesh=new GLMesh({gl:this.gl,attributes:[["position",{data:new Float32Array([-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5]),size:3}],["normal",{data:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),size:3}]],indices:new Uint8Array([0,2,3,0,3,1,4,6,7,4,7,5,8,10,11,8,11,9,12,14,15,12,15,13,16,18,19,16,19,17,20,22,23,20,23,21])}),this.vertexArray=new GLVertexArray({gl:this.gl,mesh:this.mesh,program:this.program})}resize(e,t){this.camera.aspectRatio=e/t,this.update()}update(){this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.cameraController.update(),this.program.use(),this.program.uniforms.set("projectionView",this.camera.projectionView),this.vertexArray.bind(),this.mesh.draw()}}window.customElements.define("xp-smoke",class extends LoopElement{connectedCallback(){this.innerHTML=`
      <style>
        @import "src/main/index.css";
      </style>
      <canvas></canvas>
    `,this.canvas=this.querySelector("canvas"),this.view=new View({canvas:this.canvas}),this.querySelector("style").addEventListener("load",()=>{this.dispatchEvent(new Event("load")),this.resize()}),window.addEventListener("resize",this._resizeBinded=this.resize.bind(this)),this.play()}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._resizeBinded)}resize(){let e=this.canvas.offsetWidth,t=this.canvas.offsetHeight;this.canvas.width=e*window.devicePixelRatio,this.canvas.height=t*window.devicePixelRatio,this.view.resize(e,t)}update(){this.view.update()}});